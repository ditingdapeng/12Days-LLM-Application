## ğŸŒŸ DSPyé¡¹ç›®èƒŒæ™¯

**DSPy** æ˜¯æ–¯å¦ç¦å¤§å­¦å¼€å‘çš„LLMç¼–ç¨‹æ¡†æ¶ï¼Œåœ¨GitHubä¸Šå·²è·å¾—**27.5k+ stars**ï¼Œ
ä»£è¡¨ç€å£°æ˜å¼AIåº”ç”¨å¼€å‘çš„æ–°èŒƒå¼ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯é€šè¿‡ç¼–å†™ç»„åˆå¼Pythonä»£ç ï¼Œè€Œä¸è¿‡åº¦ä¾èµ–Promptå·¥ç¨‹ã€‚

é¡¹ç›®åœ°å€ï¼š 
https://github.com/stanfordnlp/dspy

## ä»é—®é¢˜å¼€å§‹

å‡å¦‚è®©ä½ æ„å»ºä¸€ä¸ªAIåº”ç”¨ï¼Œä»»åŠ¡æ˜¯å¯¹ç”¨æˆ·è¯„è®ºè¿›è¡Œæƒ…æ„Ÿåˆ†æã€‚ä½¿ç”¨æç¤ºè¯Promptçš„æ–¹å¼ä¸‹ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ

```python
prompt = "è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿï¼Œè¿”å›0-10çš„åˆ†æ•°ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºè¶Šç§¯æï¼š{text}"
response = llm.generate(prompt.format(text="æˆ‘å¾ˆå¼€å¿ƒï¼"))
```

ä½†è¿™ç§æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿå½“æç¤ºå†…å®¹å¤æ‚çš„æ—¶å€™ï¼Œæ¯æ¬¡è°ƒæ•´éƒ½éœ€è¦é‡å†™Promptã€‚å½“é¢å¯¹ä¸åŒä»»åŠ¡æ—¶ï¼Œéƒ½è¦é‡æ–°è®¾è®¡Promptã€‚å½“æ¨¡å‹æ›´æ¢æ—¶ï¼Œå¯èƒ½è¿˜éœ€è¦é‡æ–°è°ƒè¯•Promptã€‚

é‚£åŒæ ·çš„ä»»åŠ¡ï¼Œé€šè¿‡Dspyæ˜¯æ€ä¹ˆè§£å†³çš„ï¼ŸDspyçš„æ ¸å¿ƒæ˜¯ï¼šé€šè¿‡åœ¨å®¢æˆ·ç«¯å£°æ˜æ•°æ®æ ¼å¼ï¼Œå°†LLMè°ƒç”¨çœ‹ä½œæ˜¯APIè°ƒç”¨ã€‚

è¿™é‡Œçš„å…³é”®æ˜¯**å£°æ˜å¼**ï¼Œé¦–å…ˆè¦ç†è§£ä¼ ç»Ÿçš„APIçš„è°ƒç”¨æ–¹å¼ï¼Œé€šå¸¸ç”±æœåŠ¡ç«¯é¢„å…ˆå®šä¹‰å¥½æ¥å£æ ¼å¼ï¼Œç„¶åå®¢æˆ·ç«¯å¿…é¡»æŒ‰ç…§æœåŠ¡ç«¯çš„è§„èŒƒå‘é€è¯·æ±‚ï¼Œæ•°æ®æ ¼å¼æ˜¯"æœåŠ¡ç«¯ä¸»å¯¼"çš„ï¼ŒæœåŠ¡ç«¯è¯´ä»€ä¹ˆæ ¼å¼ï¼Œå®¢æˆ·ç«¯å°±å¿…é¡»ç”¨ä»€ä¹ˆæ ¼å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒæœåŠ¡ç«¯æŒ‰ä¸‹é¢å®šä¹‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼ å‚æ•°æ—¶ï¼Œå¿…é¡»ä¼ cityã€dateã€‚ï¼š

```python
response = requests.post('/api/weather', {
    'city': 'åŒ—äº¬',        
    'date': '2025-08-23'          # å¿…é¡»æŒ‰æœåŠ¡ç«¯è¦æ±‚
})
temp = response['temperature']  # æœåŠ¡ç«¯å†³å®šè¿”å›ä»€ä¹ˆå­—æ®µ
```

è€ŒDspyæ˜¯å®¢æˆ·ç«¯ï¼ˆä»£ç ï¼‰å®šä¹‰è¾“å…¥è¾“å‡ºæ ¼å¼ï¼ŒæœåŠ¡ç«¯LLMå»è‡ªé€‚åº”ï¼Œæ˜¯å£°æ˜å¼çš„å¼€å‘æ–¹å¼ã€‚

```python
# DSPyï¼šLLMé€‚åº”ä½ å®šä¹‰çš„æ ¼å¼
class WeatherQuery(dspy.Signature):
    city = dspy.InputField()           # è¾“å…¥city
    temperature = dspy.OutputField()          # è¾“å‡ºæ¸©åº¦
```

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸å¿…è¦è·Ÿéšç€LLMçš„å“åº”ç»“æœèµ°äº†ã€‚ä¼ ç»ŸAPIå›ºå®šäº†å“åº”æ ¼å¼ï¼Œå½“LLMè¾“å‡ºæ ¼å¼ä¸ç¨³å®šæ—¶ï¼Œè¿˜éœ€è¦å…¼å®¹ä¿®æ”¹è§£æä»£ç ï¼Œå½±å“è§£æç»“æœã€‚


## Dspyå®ç°æœºåˆ¶-å››ä¸ªæ ¸å¿ƒæ¨¡å—

è¿™é‡Œç”¨æƒ…æ„Ÿåˆ†æçš„ä¾‹å­æ¥è´¯ç©¿è¿™å››ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚

### Signatureï¼šæ¥å£å®šä¹‰æ¨¡å—
Signatureè´Ÿè´£æ˜¾å¼å®šä¹‰LLMäº¤äº’çš„è¾“å…¥è¾“å‡ºæ ¼å¼ï¼Œä½¿å¾—æ¨¡å‹å“åº”æ— éœ€æ‰‹åŠ¨è§£æå­—æ®µï¼Œç¡®ä¿æ¯æ¬¡LLMè°ƒç”¨éƒ½æœ‰æ˜ç¡®çš„å…±è¯†ã€‚æ ¹æ®åº”ç”¨å¤æ‚åº¦çš„ä¸åŒï¼ŒDSPyæä¾›äº†ä¸¤ç§Signatureå®šä¹‰æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šç±»åŸºç­¾åï¼ˆé€‚ç”¨äºå¤æ‚ä»»åŠ¡ï¼‰
å½“éœ€è¦ç²¾ç¡®æ§åˆ¶å­—æ®µç±»å‹ã€æè¿°å’Œçº¦æŸæ—¶ï¼Œæ¨èä½¿ç”¨ç±»åŸºç­¾åã€‚å®ƒé€šè¿‡ç»§æ‰¿ dspy.Signature ç±»å®ç°ï¼ŒåŒ…å« äº”ä¸ªæ ¸å¿ƒç»„ä»¶ ï¼š
- docstringï¼šä»»åŠ¡æè¿°æŒ‡ä»¤ï¼Œå®šä¹‰LLMè°ƒç”¨çš„ç›®çš„
- å­—æ®µåç§°ï¼šç”¨äºæºå¸¦è¾“å…¥æ•°æ®å’Œè®¿é—®è¾“å‡ºæ•°æ®çš„æ ‡è¯†ç¬¦
- è¾“å…¥è¾“å‡ºæ ‡è¯†ï¼š InputFieldã€OutputField æ ‡è®°å­—æ®µä½œç”¨
- descï¼šå­—æ®µçš„é¢å¤–ä¿¡æ¯æè¿°ï¼Œå½“å­—æ®µåä¸å¤Ÿè‡ªè§£é‡Šæ—¶å¾ˆæœ‰ç”¨
- ç±»å‹æ³¨è§£ï¼šæ”¯æŒåŸºæœ¬Pythonç±»å‹ã€è‡ªå®šä¹‰ç±»æˆ–Pydanticæ¨¡å‹

```python
class SentimentClassifier(dspy.Signature):
    """å¯¹ç»™å®šæ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†ç±»."""
    text: str = dspy.InputField(desc="éœ€è¦åˆ†ææƒ…æ„Ÿçš„è¾“å…¥æ–‡æœ¬")
    sentiment: int = dspy.OutputField(
        desc="æƒ…æ„Ÿåˆ†æ•°ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºè¶Šç§¯ææ­£é¢ï¼ŒèŒƒå›´0-10",
        choices=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    )
```

#### æ–¹å¼äºŒï¼šå­—ç¬¦ä¸²åŸºç­¾åï¼ˆé€‚ç”¨äºå¿«é€ŸåŸå‹ï¼‰
å½“éœ€è¦å¿«é€Ÿå®éªŒå’ŒåŸå‹å¼€å‘æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ç­¾åï¼š
```python
# å­—ç¬¦ä¸²åŸºç­¾åç¤ºä¾‹
classify = dspy.Predict("text -> sentiment: int")
```

### Moduleï¼šé€»è¾‘å°è£…æ¨¡å—

Moduleè´Ÿè´£å°è£…ä¸LLMäº¤äº’çš„ä¸šåŠ¡é€»è¾‘ã€‚å½“é€šè¿‡Signatureå®šä¹‰å¥½è¾“å…¥è¾“å‡ºæ¥å£åï¼ŒModuleå°†è¿™äº›æ¥å£ç»„ç»‡æˆå¯æ‰§è¡Œçš„æ¨ç†æµç¨‹ï¼ŒæŠŠå¤šä¸ªSignatureç»„åˆæˆå¤æ‚æ¨ç†é“¾ï¼Œå†é€šè¿‡forward()æ–¹æ³•ç®¡ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œã€‚æ ¹æ®åº”ç”¨å¤æ‚åº¦çš„ä¸åŒï¼ŒDSPyæä¾›äº†ä¸¤ç§Moduleä½¿ç”¨æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨å†…ç½®Moduleï¼ˆé€‚ç”¨äºç®€å•ä»»åŠ¡ï¼‰
å½“ä»»åŠ¡ç›¸å¯¹ç®€å•æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨DSPyæä¾›çš„å†…ç½®æ¨¡å—ï¼š
- dspy.Predict ï¼šæœ€åŸºç¡€çš„æ¨¡å—ï¼Œå†…éƒ¨å·²ç»å®ç°äº†init å’Œ forward ï¼Œç›´æ¥å°†Signatureè½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„LLMè°ƒç”¨
- dspy.ChainOfThought ï¼šå¸¦æ¨ç†è¿‡ç¨‹çš„æ¨¡å—ï¼Œåœ¨è¾“å‡ºä¸­å¢åŠ reasoningå­—æ®µ
- dspy.ReAct ï¼šæ¨ç†å’Œè¡ŒåŠ¨ç»“åˆçš„æ¨¡å—ï¼Œé€‚ç”¨äºéœ€è¦å·¥å…·è°ƒç”¨çš„åœºæ™¯

```python
# ä½¿ç”¨å†…ç½®æ¨¡å—çš„æƒ…æ„Ÿåˆ†æç¤ºä¾‹
classify = dspy.Predict(SentimentClassifier)
result = classify(text="æˆ‘å¾ˆå¼€å¿ƒï¼")
```

#### æ–¹å¼äºŒï¼šè‡ªå®šä¹‰Moduleï¼ˆé€‚ç”¨äºå¤æ‚åº”ç”¨ï¼‰
å½“éœ€è¦æ„å»ºå¤æ‚çš„å¤šæ­¥éª¤æ¨ç†æµç¨‹æ—¶ï¼Œéœ€è¦ç»§æ‰¿ dspy.Module å¹¶è‡ªå®šä¹‰é€»è¾‘ï¼š
- ç»§æ‰¿ dspy.Module ï¼šè·å¾—æ¨¡å—åŒ–çš„åŸºç¡€èƒ½åŠ›
- å®ç° initæ–¹æ³• ï¼šåˆå§‹åŒ–å­æ¨¡å—å’Œé…ç½®å±æ€§
- å®ç° forward æ–¹æ³• ï¼šå®šä¹‰å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œæµç¨‹
- ç»„åˆå¤šä¸ªå­æ¨¡å— ï¼šå°†å¤šä¸ªSignatureç»„åˆæˆå¤æ‚æ¨ç†é“¾

```python
# è‡ªå®šä¹‰æ¨¡å—ç¤ºä¾‹
class CelebrityGuess(dspy.Module):
    def __init__(self):
        self.question_generator = dspy.ChainOfThought(QuestionGenerator)
        self.reflection = dspy.ChainOfThought(Reflection)
    
    def forward(self, celebrity_name):
        # å¤æ‚çš„å¤šè½®å¯¹è¯é€»è¾‘
        # ...
```

### Adapterï¼šæ ¼å¼è½¬æ¢æ¨¡å—
Adapterè´Ÿè´£åœ¨Signatureå’ŒLLMä¹‹é—´è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚å½“é€šè¿‡Signatureå®šä¹‰å¥½è¾“å…¥è¾“å‡ºæ¥å£åï¼ŒAdapterå°†è¿™äº›æ¥å£è½¬æ¢æˆLLMèƒ½ç†è§£çš„promptæ ¼å¼ï¼Œå¹¶å°†LLMçš„æ–‡æœ¬å“åº”è§£æä¸ºç»“æ„åŒ–æ•°æ®ï¼Œå®ç°å°†è¯­è¨€æ¨¡å‹å½“ä½œ"æœ‰æ˜ç¡®å®šä¹‰è¾“å…¥è¾“å‡ºçš„API"æ¥ä½¿ç”¨çš„ç›®æ ‡ã€‚æ ¹æ®è½¬æ¢å¤æ‚åº¦çš„ä¸åŒï¼ŒDSPyæä¾›äº†ä¸¤ç§Adapterä½¿ç”¨æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨é€‰æ‹©Adapterï¼ˆé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼‰
å½“ä½¿ç”¨DSPyçš„å†…ç½®æ¨¡å—æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„Adapterï¼š

```python
# è‡ªåŠ¨é€‰æ‹©Adapterçš„æƒ…æ„Ÿåˆ†æç¤ºä¾‹
classify = dspy.Predict(SentimentClassifier)
result = classify(text="æˆ‘å¾ˆå¼€å¿ƒï¼")
# Adapterè‡ªåŠ¨å¤„ç†promptæ„å»ºå’Œå“åº”è§£æ
print(result.sentiment)  # ç›´æ¥è®¿é—®ç»“æ„åŒ–ç»“æœ
```

#### æ–¹å¼äºŒï¼šè‡ªå®šä¹‰Adapter
å½“éœ€è¦ç‰¹å®šçš„promptæ ¼å¼æˆ–è§£æé€»è¾‘æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰Adapterï¼š
```python
# é…ç½®è‡ªå®šä¹‰Adapterç¤ºä¾‹
dspy.settings.configure(
    lm=dspy.LM("openai/gpt-4o-mini"),
    adapter=CustomAdapter()  # ä½¿ç”¨è‡ªå®šä¹‰é€‚é…å™¨
)
```


#### å®é™…æ‰§è¡Œæµç¨‹ï¼ˆéšå¼ï¼‰
Adapteré…ç½®å®Œæˆåï¼Œè¿è¡Œæ—¶å®é™…çš„å·¥ä½œæµç¨‹ä¸»è¦æœ‰ä¸‰æ­¥ï¼ˆéšå¼å®ç°ï¼‰ï¼š**æ¥å—è¾“å…¥->æ„å»ºprompt->è§£æå“åº”**ã€‚

1. æ¥æ”¶ä¸‰ç±»è¾“å…¥ï¼šSignatureï¼ˆç­¾åå®šä¹‰ï¼‰ã€User inputï¼ˆç”¨æˆ·è¾“å…¥ï¼‰ã€Module infoï¼ˆæ¨¡å—ä¿¡æ¯ï¼‰
2. æ„å»ºç»“æ„åŒ–prompt
3. è§£æLLMå“åº”

å¯ä»¥é€šè¿‡`dspy.inspect_history()`æŸ¥çœ‹Adapterçš„å®Œæ•´å·¥ä½œè¿‡ç¨‹ï¼š
```python
# LLMçš„åŸå§‹è¾“å‡º
"""
[[ ## reasoning ## ]]
The text "æˆ‘å¾ˆå¼€å¿ƒï¼" expresses a clear positive emotion with the word "å¼€å¿ƒ" (happy). The exclamation mark further emphasizes the positive sentiment.

[[ ## sentiment ## ]]
9
"""

# Adapterè§£æåçš„ç»“æ„åŒ–ç»“æœ
result.reasoning = "'The text "æˆ‘å¾ˆå¼€å¿ƒï¼" expresses a clear positive emotion with the word "å¼€å¿ƒ" (happy). The exclamation mark further emphasizes the positive sentiment.'"
result.sentiment = 9  # è‡ªåŠ¨è½¬æ¢ä¸ºintç±»å‹
```

![](https://fastly.jsdelivr.net/gh/bucketio/img3@main/2025/08/23/1755964163590-99cd88b8-b94f-4c1e-a1ef-02f0c9d4fa54.png)

æ³¨æ„ï¼šä½¿ç”¨`dspy.ChainOfThought`æ‰ä¼šåŒ…å«æ¨ç†è¿‡ç¨‹ï¼Œç›´æ¥ä½¿ç”¨`dspy.Predict`ä¸ä¼šæ˜¾ç¤ºæ¨ç†è¿‡ç¨‹(ä¹Ÿå°±æ˜¯reasoning)ï¼Œè€Œæ˜¯ç›´æ¥è¾“å‡ºç»“æœã€‚

### Optimizerï¼šæ€§èƒ½ä¼˜åŒ–æ¨¡å—

Optimizerè´Ÿè´£è‡ªåŠ¨ä¼˜åŒ–DSPyç¨‹åºçš„æ€§èƒ½ï¼Œè§£å†³ä¼ ç»Ÿæ‰‹å·¥è°ƒè¯•promptçš„ç—›ç‚¹ã€‚å½“æ„å»ºå¥½Moduleå’ŒSignatureåï¼ŒOptimizeré€šè¿‡æ™ºèƒ½æœç´¢å’Œè¯„ä¼°ï¼Œè‡ªåŠ¨æ‰¾åˆ°æœ€ä¼˜çš„promptæ¨¡æ¿å’Œfew-shotç¤ºä¾‹ç»„åˆï¼Œå®ç°ç¨‹åºè´¨é‡çš„æ˜¾è‘—æå‡ã€‚æ ¹æ®ä¼˜åŒ–éœ€æ±‚çš„ä¸åŒï¼ŒDSPyæä¾›äº†ä¸¤ç§Optimizerä½¿ç”¨æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨æ¨¡å¼ä¼˜åŒ–ï¼ˆé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼‰
å½“éœ€è¦å¿«é€Ÿè·å¾—ä¼˜åŒ–æ•ˆæœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨DSPyæä¾›çš„è‡ªåŠ¨æ¨¡å¼ï¼š
- MIPRO V2ä¼˜åŒ–å™¨ ï¼šä¸“é—¨ç”¨äºæç¤ºæ¨¡æ¿ä¼˜åŒ–å’Œæ„å»ºfew-shotç¤ºä¾‹çš„ä¼˜åŒ–å™¨
- è‡ªåŠ¨æ¨¡å¼é…ç½® ï¼šæä¾›lightã€mediumã€heavyä¸‰ç§é¢„è®¾æ¨¡å¼
- ç»„åˆç­–ç•¥ ï¼šä½¿ç”¨è´å¶æ–¯é‡‡æ ·æ–¹æ³•æœç´¢æœ€ä¼˜ç»„åˆ
```python
# ä½¿ç”¨è‡ªåŠ¨æ¨¡å¼çš„ä¼˜åŒ–ç¤ºä¾‹
optimizer = dspy.MIPROv2(mode="auto")  # å¯é€‰ï¼šlight, medium, heavy
optimized_program = optimizer.compile(
    student=program,
    trainset=train_data,
    valset=val_data,
    metric=accuracy_metric
)
```

è¿™é‡Œçš„program å°±æ˜¯ä½ è‡ªå·±æ„å»ºçš„ DSPy æ¨¡å—å®ä¾‹ ã€‚å¯ä»¥æ˜¯ï¼š`dspy.Predict`ã€`dspy.ChainOfThought`ã€ `dspy.ReAct`æˆ–è€…è‡ªå®šä¹‰æ¨¡å—ã€‚train_dataæ˜¯ä½ ç”¨æ¥ä¼˜åŒ–çš„æ•°æ®é›†ï¼Œç±»ä¼¼HotPotQAæ‰€ä½¿ç”¨çš„QAæ•°æ®é›†ã€‚Optimizerä¼šç”¨è¿™äº›æ•°æ®æ¥ç”Ÿæˆ few-shot ç¤ºä¾‹(é€šè¿‡ bootstrapping è¿‡ç¨‹)ï¼Œé€‰æ‹©æœ€ä½³çš„æŒ‡ä»¤å’Œç¤ºä¾‹ç»„åˆã€‚ 

```python
# HotPotQAæ•°æ®é›†ç¤ºä¾‹
train_data = [
    {
        "question": "Which magazine was started first Arthur's Magazine or First for Women?",
        "answer": "Arthur's Magazine"
    },
    # ... æ›´å¤šè®­ç»ƒæ ·æœ¬
]
```



#### æ–¹å¼äºŒï¼šè‡ªå®šä¹‰ä¼˜åŒ–
å½“éœ€è¦ç²¾ç»†æ§åˆ¶ä¼˜åŒ–è¿‡ç¨‹æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¼˜åŒ–å™¨é…ç½®ï¼š

```python
# è‡ªå®šä¹‰ä¼˜åŒ–ç¤ºä¾‹
def custom_metric(example, prediction):
    return example.answer == prediction.answer

# custom_metric: ä½¿ç”¨ä»€ä¹ˆè¯„ä¼°æŒ‡æ ‡
# max_bootstrapped_demos: æœ€å¤šç”Ÿæˆå¤šå°‘ä¸ªbootstrapç¤ºä¾‹
# max_labeled_demos: æœ€å¤šä½¿ç”¨å¤šå°‘ä¸ªæ ‡æ³¨ç¤ºä¾‹
optimizer = dspy.BootstrapFewShot(
    metric=custom_metric,
    max_bootstrapped_demos=8,
    max_labeled_demos=4
)


optimized_program = optimizer.compile(
    student=program,
    trainset=train_data
)
```

#### å®é™…æ‰§è¡Œæµç¨‹ï¼ˆéšå¼ï¼‰
å½“è°ƒç”¨`ptimizer.compile() `ï¼ŒDSPy å®é™…ä¼šæ‰§è¡Œå››æ­¥æµç¨‹ï¼š
1. æ„å»ºfew-shotç¤ºä¾‹é›†ï¼šæ–¹å¼æ˜¯é€šè¿‡bootstrappingï¼Œä»è®­ç»ƒæ•°æ®ä¸­å–æ ·æœ¬ï¼Œè¾“å…¥DSPyç¨‹åºæ‰§è¡Œï¼Œè®°å½•å®Œæ•´çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä½¿ç”¨åº¦é‡å‡½æ•°è¯„ä¼°è¾“å‡ºè´¨é‡ï¼Œå½“å¾—åˆ†è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶ï¼Œæå–è¯¥è¿‡ç¨‹ä¸­æ¯ä¸ªæ¨¡å—çš„è¾“å…¥-è¾“å‡ºå¯¹ï¼Œä½œä¸ºè¯¥æ¨¡å—æœªæ¥çš„few-shotç¤ºä¾‹å€™é€‰ï¼›

2. ç”ŸæˆæŒ‡ä»¤å€™é€‰ï¼šæ”¶é›†åŠŸèƒ½æè¿°ã€few-shotç¤ºä¾‹å’Œé£æ ¼æç¤ºç­‰ä¿¡æ¯ï¼Œå°†å®ƒä»¬ç»„åˆæˆç»“æ„åŒ–è¾“å…¥ï¼Œå‘é€ç»™DSPy proposerï¼ˆæŒ‡ä»¤ç”Ÿæˆå™¨ï¼‰ï¼Œè¯¥ç»„ä»¶åŸºäºè¿™äº›ä¿¡æ¯ç”Ÿæˆå¤šä¸ªé’ˆå¯¹ç‰¹å®šæ¨¡å—çš„æŒ‡ä»¤å€™é€‰ï¼Œä¸ºåç»­çš„ä¼˜åŒ–è¿‡ç¨‹æä¾›æ›´å¤šæŒ‡ä»¤é€‰æ‹©ï¼›

3. æ™ºèƒ½ç»„åˆè¯„ä¼°ï¼šä½¿ç”¨è´å¶æ–¯æŠ½æ ·æ–¹æ³•ä»few-shotç¤ºä¾‹é›†å’ŒæŒ‡ä»¤å€™é€‰é›†ä¸­æ™ºèƒ½é€‰æ‹©ç»„åˆï¼Œæ„å»ºå€™é€‰ç¨‹åºå¹¶è¿›è¡Œè¯„ä¼°ã€‚è¯„ä¼°è¿‡ç¨‹åŸºäºç”¨æˆ·å®šä¹‰çš„åº¦é‡å‡½æ•°å’ŒéªŒè¯æ•°æ®é›†ï¼Œé€šè¿‡å°†ç¨‹åºè¾“å‡ºä¸æ ‡å‡†ç­”æ¡ˆè¿›è¡Œæ¯”è¾ƒæ¥è®¡ç®—å¾—åˆ†ï¼›

4. é€‰æ‹©æœ€ä¼˜é…ç½®ï¼šæœ€ç»ˆé€‰æ‹©å¾—åˆ†æœ€é«˜çš„å€™é€‰ç¨‹åºä½œä¸ºä¼˜åŒ–åçš„æœ€ç»ˆé…ç½®ï¼›

## æ¡ˆä¾‹ä¸€-æƒ…æ„Ÿåˆ†æå®ç°
### éœ€æ±‚æè¿°
æ„å»ºä¸€ä¸ªæƒ…æ„Ÿåˆ†æç³»ç»Ÿï¼Œè¦æ±‚ï¼š
- **è¾“å…¥**ï¼šä»»æ„æ–‡æœ¬
- **è¾“å‡º**ï¼š0-10çš„æƒ…æ„Ÿåˆ†æ•°ï¼ˆ0=æåº¦æ¶ˆæï¼Œ10=æåº¦ç§¯æï¼‰
- **é™„åŠ **ï¼šæä¾›æ¨ç†è¿‡ç¨‹

### ä»£ç å®ç°
ç»“åˆå‰é¢æåˆ°çš„å››ä¸ªæ¨¡å—ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°ï¼š

![](https://fastly.jsdelivr.net/gh/bucketio/img3@main/2025/08/24/1755966985262-b41d7b41-5bb1-46a2-9882-766ec82cef52.png)


## æ¡ˆä¾‹äºŒ-çŒœäººåæ¸¸æˆå¤šè½®å¯¹è¯
### éœ€æ±‚æè¿°
æ„å»ºä¸€ä¸ª"çŒœåäºº"æ¸¸æˆAIä»£ç†ï¼š
- **æ¸¸æˆè§„åˆ™ï¼š** ç”¨æˆ·æƒ³ä¸€ä¸ªåäººï¼ŒAIé€šè¿‡æé—®Yes/Noé—®é¢˜æ¥çŒœæµ‹
- **é™åˆ¶æ¡ä»¶ï¼š** æœ€å¤š20æ¬¡æé—®æœºä¼š

### è®¾è®¡æ€è·¯
#### 1. å¤šè½®å¯¹è¯
é¦–å…ˆæ€è€ƒå¤šè½®å¯¹è¯çš„è®¾è®¡å®ç°ï¼Œæ—¢ç„¶æ˜¯å¤šè½®å¯¹è¯ï¼Œå°±è¦åŒ…å«å†å²å¯¹è¯çš„å†…å®¹ä¿¡æ¯ã€‚æ²¡æœ‰å†å²æ„ŸçŸ¥çš„æ–¹å¼ï¼Œæ˜¯æ¯æ¬¡éƒ½é‡æ–°å¼€å§‹ï¼Œä¾‹å¦‚ï¼š

```python
# æ¯è½®ç‹¬ç«‹ï¼Œå†å²å®¹æ˜“ä¸¢å¤±
for attempt in range(20):
    question = generate_question()  # ä»é›¶å¼€å§‹ï¼Œæ— å†å²æ„ŸçŸ¥
    answer = get_user_input()
```

ä½¿ç”¨dspyè¦ä¼ å…¥å®Œæ•´çš„å†å²ï¼Œæ¯æ¬¡çš„å†³ç­–éƒ½æ˜¯åŸºäºå…¨å±€çš„ä¸Šä¸‹æ–‡ï¼š
```python
# æ¯è½®éƒ½æ˜¯åŸºäºå®Œæ•´å†å²çš„æ™ºèƒ½å†³ç­–
for attempt in range(20):
    question_result = self.question_generator(
        past_questions="\n".join(past_questions),  # ä¼ å…¥å®Œæ•´å†å²
        past_answers="\n".join(past_answers)       # ä¼ å…¥å®Œæ•´å†å²
    )
    # æ–°çš„äº¤äº’ç«‹å³æˆä¸ºä¸‹ä¸€è½®çš„å†å²
    past_questions.append(question_result.new_question)
    past_answers.append(answer)
```

#### 2. åˆ†å±‚æ¨ç†-ChainOfThoughtçš„reasoning
è¦æƒ³å›ç­”æ­£ç¡®ï¼Œéœ€è¦ä»å®½æ³›çš„é—®é¢˜é€æ­¥ç¼©å°èŒƒå›´åˆ°å…·ä½“ç­”æ¡ˆã€‚é€šè¿‡reasoningå’Œå†å²ä¸Šä¸‹æ–‡ï¼Œç”±AIè‡ªåŠ¨æ¥åšåˆ†å±‚æ¨ç†ã€‚


#### 3. åˆ¤æ–­æ¨ç†æˆåŠŸ
è®¾ç½®guess_madeï¼Œå½“AIè®¤ä¸ºæœ‰è¶³å¤Ÿçš„ä¿¡æ¯å¯ä»¥æ¨æ–­æ—¶ï¼Œguess_made=Trueæ—¶ï¼ŒAIè®¤ä¸ºä¿¡æ¯è¶³å¤Ÿï¼Œå¼€å§‹ç›´æ¥çŒœæµ‹ã€‚å½“guess_made=Falseæ—¶ï¼ŒAIç”Ÿæˆå®½æ³›çš„åˆ†ç±»é—®é¢˜ç»§ç»­æé—®ã€‚

```python
class QuestionGenerator(dspy.Signature):
    """Generate a yes/no question to narrow down the celebrity guess."""
    past_questions: str = dspy.InputField(desc="previously asked questions")
    past_answers: str = dspy.InputField(desc="corresponding yes/no answers")
    new_question: str = dspy.OutputField(desc="new yes/no question to ask")
    guess_made: bool = dspy.OutputField(desc="whether this is a direct guess") 
```


### ä»£ç å®ç°

å®šä¹‰å­æ¨¡å—Signatureï¼š
![](https://fastly.jsdelivr.net/gh/bucketio/img16@main/2025/08/24/1755969426360-2d39d6be-2a2c-4a9b-a91a-b3e66c8e9b7a.png)

æ§åˆ¶æµç¨‹æ¨¡å—ï¼š
![](https://fastly.jsdelivr.net/gh/bucketio/img6@main/2025/08/24/1755969485868-1d483d5f-10d1-46c3-8912-7851d9f8cd06.png)

![](https://fastly.jsdelivr.net/gh/bucketio/img16@main/2025/08/24/1755969582856-46b07524-7f4b-49e1-bbe3-b2ece056ca0a.png)

æ¸¸æˆæ¼”ç¤ºï¼š
![](https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/08/24/1755969658090-348b721d-a359-4761-98ba-d040cc63145a.png)
è¿è¡Œç»“æœï¼š

![](https://fastly.jsdelivr.net/gh/bucketio/img7@main/2025/08/24/1755972177311-92afba94-ff6f-4394-a20e-0bc988e40c50.png)
